# DeepFake

## 原理
- DeepFake 是一位名叫deepfakes 的用户在2017 年上传到Reddit 的一种采用神经网络实现的换脸 方法，该模型的总体结构是encoder-decoder 模型，采用了一个 encoder 与两个 decoder 的结构。主要 思想是通过类似autoencoder 的方法将输入的人脸扭曲后能够复现出原始脸，并且最终可以实现在任 意的人脸上都可以复现想要的人脸。采用该方法可以比较方便快捷地生成影视作品，并且成本较低，具有较高的应用价值。
- 但该方法区别于传统的自编码器，采用了一个 encoder 与两个 decoder，基本原理如下图，在一 个人的脸上重构另一个人的脸，从而实现换脸的过程。也就是我们设计一个输入端或者说一个编码 器(分别输入两个不同的脸)，然后两个输出端或者说两个解码器，这样我们就可以通过隐含层来分别生成两张不同的人脸了。


![](https://pic4.zhimg.com/80/v2-738676769eb437382427ee829bf77bef_1440w.jpg)

## Experiment Memo

### 环境要求
- 最新版 py3.7⬆️+tf-gpu2.2⬆️
- 采用 **git tag** 回退至版本1.0.0，py3.6⬆️+tf-gpu1.12.0-1.15.3
- 目前运行环境 CUDA10.1+py3.6+tf-gpu1.14

### 算法流程
1. Extract 
   S3FD网络逐帧提取人脸，10fps左右，可能需要人工清洗数据
2. Train
   约5min迭代1000iters，需要训练至两个人脸loss全部降到0.015左右，GPU平均需要12-48h
3. Convert
   根据训练好的模型，批量转换原视频帧，即预测阶段，约10fps
4. 帧拼接

### Memo
1. 需要两段包含人脸的视频或图片文件夹，最好500帧以上
2. 包含人脸不同角度的帧会使训练效果提升

### ZAO软件调研
- 陌陌公司产品，一张正脸照片即可制作热门表情包、经典电影片段等，但相关算法从未公布
- 网上大部分猜测背后算法是DeepFake或CycleGan，但是根据输入和训练时长来看完全不可能
- 在自拍的时候挡住五官，尤其是颜色鲜艳的遮挡物，换脸严重失败。参考知乎 zhuanlan.zhihu.com/p/82054404 , 遮挡住眼睛鼻子嘴等，发现最终换的人脸并不是自己的
- 猜想原理类似DeepNude https://github.com/yuanxiaosc/DeepNude-an-Image-to-Image-technology ，ZAO没有将用户真正的脸换到预置视频中，可能制作了大量换脸模版，通过预置换脸模板和预置视频提前训练出大量预置模型，通过匹配与用户最相似的脸或五官特征达到换脸目的
- 应该完全是工程手段

## Reference
- https://zhuanlan.zhihu.com/p/133705011